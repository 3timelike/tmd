{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nvar core = require('@vueuse/core');\nrequire('../../../utils/index.js');\nrequire('../../../hooks/index.js');\nvar affix = require('./affix.js');\nvar pluginVue_exportHelper = require('../../../_virtual/plugin-vue_export-helper.js');\nvar index = require('../../../hooks/use-namespace/index.js');\nvar style = require('../../../utils/dom/style.js');\nvar error = require('../../../utils/error.js');\nvar scroll = require('../../../utils/dom/scroll.js');\nconst COMPONENT_NAME = \"ElAffix\";\nconst __default__ = vue.defineComponent({\n  name: COMPONENT_NAME\n});\nconst _sfc_main = /* @__PURE__ */vue.defineComponent({\n  ...__default__,\n  props: affix.affixProps,\n  emits: affix.affixEmits,\n  setup(__props, {\n    expose,\n    emit\n  }) {\n    const props = __props;\n    const ns = index.useNamespace(\"affix\");\n    const target = vue.shallowRef();\n    const root = vue.shallowRef();\n    const scrollContainer = vue.shallowRef();\n    const {\n      height: windowHeight\n    } = core.useWindowSize();\n    const {\n      height: rootHeight,\n      width: rootWidth,\n      top: rootTop,\n      bottom: rootBottom,\n      update: updateRoot\n    } = core.useElementBounding(root, {\n      windowScroll: false\n    });\n    const targetRect = core.useElementBounding(target);\n    const fixed = vue.ref(false);\n    const scrollTop = vue.ref(0);\n    const transform = vue.ref(0);\n    const rootStyle = vue.computed(() => {\n      return {\n        height: fixed.value ? `${rootHeight.value}px` : \"\",\n        width: fixed.value ? `${rootWidth.value}px` : \"\"\n      };\n    });\n    const affixStyle = vue.computed(() => {\n      if (!fixed.value) return {};\n      const offset = props.offset ? style.addUnit(props.offset) : 0;\n      return {\n        height: `${rootHeight.value}px`,\n        width: `${rootWidth.value}px`,\n        top: props.position === \"top\" ? offset : \"\",\n        bottom: props.position === \"bottom\" ? offset : \"\",\n        transform: transform.value ? `translateY(${transform.value}px)` : \"\",\n        zIndex: props.zIndex\n      };\n    });\n    const update = () => {\n      if (!scrollContainer.value) return;\n      scrollTop.value = scrollContainer.value instanceof Window ? document.documentElement.scrollTop : scrollContainer.value.scrollTop || 0;\n      if (props.position === \"top\") {\n        if (props.target) {\n          const difference = targetRect.bottom.value - props.offset - rootHeight.value;\n          fixed.value = props.offset > rootTop.value && targetRect.bottom.value > 0;\n          transform.value = difference < 0 ? difference : 0;\n        } else {\n          fixed.value = props.offset > rootTop.value;\n        }\n      } else if (props.target) {\n        const difference = windowHeight.value - targetRect.top.value - props.offset - rootHeight.value;\n        fixed.value = windowHeight.value - props.offset < rootBottom.value && windowHeight.value > targetRect.top.value;\n        transform.value = difference < 0 ? -difference : 0;\n      } else {\n        fixed.value = windowHeight.value - props.offset < rootBottom.value;\n      }\n    };\n    const handleScroll = () => {\n      updateRoot();\n      emit(\"scroll\", {\n        scrollTop: scrollTop.value,\n        fixed: fixed.value\n      });\n    };\n    vue.watch(fixed, val => emit(\"change\", val));\n    vue.onMounted(() => {\n      var _a;\n      if (props.target) {\n        target.value = (_a = document.querySelector(props.target)) != null ? _a : void 0;\n        if (!target.value) error.throwError(COMPONENT_NAME, `Target does not exist: ${props.target}`);\n      } else {\n        target.value = document.documentElement;\n      }\n      scrollContainer.value = scroll.getScrollContainer(root.value, true);\n      updateRoot();\n    });\n    core.useEventListener(scrollContainer, \"scroll\", handleScroll);\n    vue.watchEffect(update);\n    expose({\n      update,\n      updateRoot\n    });\n    return (_ctx, _cache) => {\n      return vue.openBlock(), vue.createElementBlock(\"div\", {\n        ref_key: \"root\",\n        ref: root,\n        class: vue.normalizeClass(vue.unref(ns).b()),\n        style: vue.normalizeStyle(vue.unref(rootStyle))\n      }, [vue.createElementVNode(\"div\", {\n        class: vue.normalizeClass({\n          [vue.unref(ns).m(\"fixed\")]: fixed.value\n        }),\n        style: vue.normalizeStyle(vue.unref(affixStyle))\n      }, [vue.renderSlot(_ctx.$slots, \"default\")], 6)], 6);\n    };\n  }\n});\nvar Affix = /* @__PURE__ */pluginVue_exportHelper[\"default\"](_sfc_main, [[\"__file\", \"affix.vue\"]]);\nexports[\"default\"] = Affix;","map":{"version":3,"names":["name","COMPONENT_NAME","ns","index","useNamespace","target","vue","shallowRef","root","scrollContainer","height","windowHeight","core","useWindowSize","rootHeight","width","rootWidth","top","rootTop","bottom","rootBottom","update","updateRoot","useElementBounding","windowScroll","targetRect","fixed","ref","scrollTop","transform","rootStyle","computed","value","affixStyle","offset","props","style","addUnit","position","zIndex","Window","document","documentElement","difference","handleScroll","emit","watch","val","onMounted","_a","querySelector","error","throwError","scroll","getScrollContainer","useEventListener","watchEffect","expose"],"sources":["../../../../../../packages/components/affix/src/affix.vue"],"sourcesContent":["<template>\n  <div ref=\"root\" :class=\"ns.b()\" :style=\"rootStyle\">\n    <div :class=\"{ [ns.m('fixed')]: fixed }\" :style=\"affixStyle\">\n      <slot />\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed, onMounted, ref, shallowRef, watch, watchEffect } from 'vue'\nimport {\n  useElementBounding,\n  useEventListener,\n  useWindowSize,\n} from '@vueuse/core'\nimport { addUnit, getScrollContainer, throwError } from '@element-plus/utils'\nimport { useNamespace } from '@element-plus/hooks'\nimport { affixEmits, affixProps } from './affix'\nimport type { CSSProperties } from 'vue'\n\nconst COMPONENT_NAME = 'ElAffix'\ndefineOptions({\n  name: COMPONENT_NAME,\n})\n\nconst props = defineProps(affixProps)\nconst emit = defineEmits(affixEmits)\n\nconst ns = useNamespace('affix')\n\nconst target = shallowRef<HTMLElement>()\nconst root = shallowRef<HTMLDivElement>()\nconst scrollContainer = shallowRef<HTMLElement | Window>()\nconst { height: windowHeight } = useWindowSize()\nconst {\n  height: rootHeight,\n  width: rootWidth,\n  top: rootTop,\n  bottom: rootBottom,\n  update: updateRoot,\n} = useElementBounding(root, { windowScroll: false })\nconst targetRect = useElementBounding(target)\n\nconst fixed = ref(false)\nconst scrollTop = ref(0)\nconst transform = ref(0)\n\nconst rootStyle = computed<CSSProperties>(() => {\n  return {\n    height: fixed.value ? `${rootHeight.value}px` : '',\n    width: fixed.value ? `${rootWidth.value}px` : '',\n  }\n})\n\nconst affixStyle = computed<CSSProperties>(() => {\n  if (!fixed.value) return {}\n\n  const offset = props.offset ? addUnit(props.offset) : 0\n  return {\n    height: `${rootHeight.value}px`,\n    width: `${rootWidth.value}px`,\n    top: props.position === 'top' ? offset : '',\n    bottom: props.position === 'bottom' ? offset : '',\n    transform: transform.value ? `translateY(${transform.value}px)` : '',\n    zIndex: props.zIndex,\n  }\n})\n\nconst update = () => {\n  if (!scrollContainer.value) return\n\n  scrollTop.value =\n    scrollContainer.value instanceof Window\n      ? document.documentElement.scrollTop\n      : scrollContainer.value.scrollTop || 0\n\n  if (props.position === 'top') {\n    if (props.target) {\n      const difference =\n        targetRect.bottom.value - props.offset - rootHeight.value\n      fixed.value = props.offset > rootTop.value && targetRect.bottom.value > 0\n      transform.value = difference < 0 ? difference : 0\n    } else {\n      fixed.value = props.offset > rootTop.value\n    }\n  } else if (props.target) {\n    const difference =\n      windowHeight.value -\n      targetRect.top.value -\n      props.offset -\n      rootHeight.value\n    fixed.value =\n      windowHeight.value - props.offset < rootBottom.value &&\n      windowHeight.value > targetRect.top.value\n    transform.value = difference < 0 ? -difference : 0\n  } else {\n    fixed.value = windowHeight.value - props.offset < rootBottom.value\n  }\n}\n\nconst handleScroll = () => {\n  updateRoot()\n  emit('scroll', {\n    scrollTop: scrollTop.value,\n    fixed: fixed.value,\n  })\n}\n\nwatch(fixed, (val) => emit('change', val))\n\nonMounted(() => {\n  if (props.target) {\n    target.value =\n      document.querySelector<HTMLElement>(props.target) ?? undefined\n    if (!target.value)\n      throwError(COMPONENT_NAME, `Target does not exist: ${props.target}`)\n  } else {\n    target.value = document.documentElement\n  }\n  scrollContainer.value = getScrollContainer(root.value!, true)\n  updateRoot()\n})\n\nuseEventListener(scrollContainer, 'scroll', handleScroll)\nwatchEffect(update)\n\ndefineExpose({\n  /** @description update affix status */\n  update,\n  /** @description update rootRect info */\n  updateRoot,\n})\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}