{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nrequire('../../../utils/index.js');\nvar loading = require('./loading.js');\nvar core = require('@vueuse/core');\nvar shared = require('@vue/shared');\nvar style = require('../../../utils/dom/style.js');\nlet fullscreenInstance = void 0;\nconst Loading = function (options = {}) {\n  if (!core.isClient) return void 0;\n  const resolved = resolveOptions(options);\n  if (resolved.fullscreen && fullscreenInstance) {\n    return fullscreenInstance;\n  }\n  const instance = loading.createLoadingComponent({\n    ...resolved,\n    closed: () => {\n      var _a;\n      (_a = resolved.closed) == null ? void 0 : _a.call(resolved);\n      if (resolved.fullscreen) fullscreenInstance = void 0;\n    }\n  });\n  addStyle(resolved, resolved.parent, instance);\n  addClassList(resolved, resolved.parent, instance);\n  resolved.parent.vLoadingAddClassList = () => addClassList(resolved, resolved.parent, instance);\n  let loadingNumber = resolved.parent.getAttribute(\"loading-number\");\n  if (!loadingNumber) {\n    loadingNumber = \"1\";\n  } else {\n    loadingNumber = `${Number.parseInt(loadingNumber) + 1}`;\n  }\n  resolved.parent.setAttribute(\"loading-number\", loadingNumber);\n  resolved.parent.appendChild(instance.$el);\n  vue.nextTick(() => instance.visible.value = resolved.visible);\n  if (resolved.fullscreen) {\n    fullscreenInstance = instance;\n  }\n  return instance;\n};\nconst resolveOptions = options => {\n  var _a, _b, _c, _d;\n  let target;\n  if (shared.isString(options.target)) {\n    target = (_a = document.querySelector(options.target)) != null ? _a : document.body;\n  } else {\n    target = options.target || document.body;\n  }\n  return {\n    parent: target === document.body || options.body ? document.body : target,\n    background: options.background || \"\",\n    svg: options.svg || \"\",\n    svgViewBox: options.svgViewBox || \"\",\n    spinner: options.spinner || false,\n    text: options.text || \"\",\n    fullscreen: target === document.body && ((_b = options.fullscreen) != null ? _b : true),\n    lock: (_c = options.lock) != null ? _c : false,\n    customClass: options.customClass || \"\",\n    visible: (_d = options.visible) != null ? _d : true,\n    target\n  };\n};\nconst addStyle = async (options, parent, instance) => {\n  const {\n    nextZIndex\n  } = instance.vm.zIndex || instance.vm._.exposed.zIndex;\n  const maskStyle = {};\n  if (options.fullscreen) {\n    instance.originalPosition.value = style.getStyle(document.body, \"position\");\n    instance.originalOverflow.value = style.getStyle(document.body, \"overflow\");\n    maskStyle.zIndex = nextZIndex();\n  } else if (options.parent === document.body) {\n    instance.originalPosition.value = style.getStyle(document.body, \"position\");\n    await vue.nextTick();\n    for (const property of [\"top\", \"left\"]) {\n      const scroll = property === \"top\" ? \"scrollTop\" : \"scrollLeft\";\n      maskStyle[property] = `${options.target.getBoundingClientRect()[property] + document.body[scroll] + document.documentElement[scroll] - Number.parseInt(style.getStyle(document.body, `margin-${property}`), 10)}px`;\n    }\n    for (const property of [\"height\", \"width\"]) {\n      maskStyle[property] = `${options.target.getBoundingClientRect()[property]}px`;\n    }\n  } else {\n    instance.originalPosition.value = style.getStyle(parent, \"position\");\n  }\n  for (const [key, value] of Object.entries(maskStyle)) {\n    instance.$el.style[key] = value;\n  }\n};\nconst addClassList = (options, parent, instance) => {\n  const ns = instance.vm.ns || instance.vm._.exposed.ns;\n  if (![\"absolute\", \"fixed\", \"sticky\"].includes(instance.originalPosition.value)) {\n    style.addClass(parent, ns.bm(\"parent\", \"relative\"));\n  } else {\n    style.removeClass(parent, ns.bm(\"parent\", \"relative\"));\n  }\n  if (options.fullscreen && options.lock) {\n    style.addClass(parent, ns.bm(\"parent\", \"hidden\"));\n  } else {\n    style.removeClass(parent, ns.bm(\"parent\", \"hidden\"));\n  }\n};\nexports.Loading = Loading;","map":{"version":3,"names":["fullscreenInstance","Loading","options","core","isClient","resolved","resolveOptions","fullscreen","instance","loading","createLoadingComponent","closed","_a","call","addStyle","parent","addClassList","vLoadingAddClassList","loadingNumber","getAttribute","Number","parseInt","setAttribute","appendChild","$el","vue","nextTick","visible","value","_b","_c","_d","target","shared","isString","document","querySelector","body","background","svg","svgViewBox","spinner","text","lock","customClass","nextZIndex","vm","zIndex","_","exposed","maskStyle","originalPosition","style","getStyle","originalOverflow","property","scroll","getBoundingClientRect","documentElement","key","Object","entries","ns","includes","addClass","bm","removeClass"],"sources":["../../../../../../packages/components/loading/src/service.ts"],"sourcesContent":["// @ts-nocheck\nimport { nextTick } from 'vue'\nimport {\n  addClass,\n  getStyle,\n  isClient,\n  isString,\n  removeClass,\n} from '@element-plus/utils'\nimport { createLoadingComponent } from './loading'\n\nimport type { UseNamespaceReturn, UseZIndexReturn } from '@element-plus/hooks'\nimport type { LoadingInstance } from './loading'\nimport type { LoadingOptionsResolved } from '..'\nimport type { LoadingOptions } from './types'\nimport type { CSSProperties } from 'vue'\n\nlet fullscreenInstance: LoadingInstance | undefined = undefined\n\nexport const Loading = function (\n  options: LoadingOptions = {}\n): LoadingInstance {\n  if (!isClient) return undefined as any\n\n  const resolved = resolveOptions(options)\n\n  if (resolved.fullscreen && fullscreenInstance) {\n    return fullscreenInstance\n  }\n\n  const instance = createLoadingComponent({\n    ...resolved,\n    closed: () => {\n      resolved.closed?.()\n      if (resolved.fullscreen) fullscreenInstance = undefined\n    },\n  })\n\n  addStyle(resolved, resolved.parent, instance)\n  addClassList(resolved, resolved.parent, instance)\n\n  resolved.parent.vLoadingAddClassList = () =>\n    addClassList(resolved, resolved.parent, instance)\n\n  /**\n   * add loading-number to parent.\n   * because if a fullscreen loading is triggered when somewhere\n   * a v-loading.body was triggered before and it's parent is\n   * document.body which with a margin , the fullscreen loading's\n   * destroySelf function will remove 'el-loading-parent--relative',\n   * and then the position of v-loading.body will be error.\n   */\n  let loadingNumber: string | null =\n    resolved.parent.getAttribute('loading-number')\n  if (!loadingNumber) {\n    loadingNumber = '1'\n  } else {\n    loadingNumber = `${Number.parseInt(loadingNumber) + 1}`\n  }\n  resolved.parent.setAttribute('loading-number', loadingNumber)\n\n  resolved.parent.appendChild(instance.$el)\n\n  // after instance render, then modify visible to trigger transition\n  nextTick(() => (instance.visible.value = resolved.visible))\n\n  if (resolved.fullscreen) {\n    fullscreenInstance = instance\n  }\n  return instance\n}\n\nconst resolveOptions = (options: LoadingOptions): LoadingOptionsResolved => {\n  let target: HTMLElement\n  if (isString(options.target)) {\n    target =\n      document.querySelector<HTMLElement>(options.target) ?? document.body\n  } else {\n    target = options.target || document.body\n  }\n  return {\n    parent: target === document.body || options.body ? document.body : target,\n    background: options.background || '',\n    svg: options.svg || '',\n    svgViewBox: options.svgViewBox || '',\n    spinner: options.spinner || false,\n    text: options.text || '',\n    fullscreen: target === document.body && (options.fullscreen ?? true),\n    lock: options.lock ?? false,\n    customClass: options.customClass || '',\n    visible: options.visible ?? true,\n    target,\n  }\n}\n\nconst addStyle = async (\n  options: LoadingOptionsResolved,\n  parent: HTMLElement,\n  instance: LoadingInstance\n) => {\n  // Compatible with the instance data format of vue@3.2.12 and earlier versions #12351\n  const { nextZIndex } =\n    ((instance.vm as any).zIndex as UseZIndexReturn) ||\n    (instance.vm as any)._.exposed.zIndex\n\n  const maskStyle: CSSProperties = {}\n  if (options.fullscreen) {\n    instance.originalPosition.value = getStyle(document.body, 'position')\n    instance.originalOverflow.value = getStyle(document.body, 'overflow')\n    maskStyle.zIndex = nextZIndex()\n  } else if (options.parent === document.body) {\n    instance.originalPosition.value = getStyle(document.body, 'position')\n    /**\n     * await dom render when visible is true in init,\n     * because some component's height maybe 0.\n     * e.g. el-table.\n     */\n    await nextTick()\n    for (const property of ['top', 'left']) {\n      const scroll = property === 'top' ? 'scrollTop' : 'scrollLeft'\n      maskStyle[property] = `${\n        (options.target as HTMLElement).getBoundingClientRect()[property] +\n        document.body[scroll] +\n        document.documentElement[scroll] -\n        Number.parseInt(getStyle(document.body, `margin-${property}`), 10)\n      }px`\n    }\n    for (const property of ['height', 'width']) {\n      maskStyle[property] = `${\n        (options.target as HTMLElement).getBoundingClientRect()[property]\n      }px`\n    }\n  } else {\n    instance.originalPosition.value = getStyle(parent, 'position')\n  }\n  for (const [key, value] of Object.entries(maskStyle)) {\n    instance.$el.style[key] = value\n  }\n}\n\nconst addClassList = (\n  options: LoadingOptions,\n  parent: HTMLElement,\n  instance: LoadingInstance\n) => {\n  // Compatible with the instance data format of vue@3.2.12 and earlier versions #12351\n  const ns =\n    ((instance.vm as any).ns as UseNamespaceReturn) ||\n    (instance.vm as any)._.exposed.ns\n\n  if (\n    !['absolute', 'fixed', 'sticky'].includes(instance.originalPosition.value)\n  ) {\n    addClass(parent, ns.bm('parent', 'relative'))\n  } else {\n    removeClass(parent, ns.bm('parent', 'relative'))\n  }\n  if (options.fullscreen && options.lock) {\n    addClass(parent, ns.bm('parent', 'hidden'))\n  } else {\n    removeClass(parent, ns.bm('parent', 'hidden'))\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}