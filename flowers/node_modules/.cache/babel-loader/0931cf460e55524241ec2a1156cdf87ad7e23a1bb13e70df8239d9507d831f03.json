{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nvar core = require('@popperjs/core');\nvar lodashUnified = require('lodash-unified');\nconst usePopper = (referenceElementRef, popperElementRef, opts = {}) => {\n  const stateUpdater = {\n    name: \"updateState\",\n    enabled: true,\n    phase: \"write\",\n    fn: ({\n      state\n    }) => {\n      const derivedState = deriveState(state);\n      Object.assign(states.value, derivedState);\n    },\n    requires: [\"computeStyles\"]\n  };\n  const options = vue.computed(() => {\n    const {\n      onFirstUpdate,\n      placement,\n      strategy,\n      modifiers\n    } = vue.unref(opts);\n    return {\n      onFirstUpdate,\n      placement: placement || \"bottom\",\n      strategy: strategy || \"absolute\",\n      modifiers: [...(modifiers || []), stateUpdater, {\n        name: \"applyStyles\",\n        enabled: false\n      }]\n    };\n  });\n  const instanceRef = vue.shallowRef();\n  const states = vue.ref({\n    styles: {\n      popper: {\n        position: vue.unref(options).strategy,\n        left: \"0\",\n        top: \"0\"\n      },\n      arrow: {\n        position: \"absolute\"\n      }\n    },\n    attributes: {}\n  });\n  const destroy = () => {\n    if (!instanceRef.value) return;\n    instanceRef.value.destroy();\n    instanceRef.value = void 0;\n  };\n  vue.watch(options, newOptions => {\n    const instance = vue.unref(instanceRef);\n    if (instance) {\n      instance.setOptions(newOptions);\n    }\n  }, {\n    deep: true\n  });\n  vue.watch([referenceElementRef, popperElementRef], ([referenceElement, popperElement]) => {\n    destroy();\n    if (!referenceElement || !popperElement) return;\n    instanceRef.value = core.createPopper(referenceElement, popperElement, vue.unref(options));\n  });\n  vue.onBeforeUnmount(() => {\n    destroy();\n  });\n  return {\n    state: vue.computed(() => {\n      var _a;\n      return {\n        ...(((_a = vue.unref(instanceRef)) == null ? void 0 : _a.state) || {})\n      };\n    }),\n    styles: vue.computed(() => vue.unref(states).styles),\n    attributes: vue.computed(() => vue.unref(states).attributes),\n    update: () => {\n      var _a;\n      return (_a = vue.unref(instanceRef)) == null ? void 0 : _a.update();\n    },\n    forceUpdate: () => {\n      var _a;\n      return (_a = vue.unref(instanceRef)) == null ? void 0 : _a.forceUpdate();\n    },\n    instanceRef: vue.computed(() => vue.unref(instanceRef))\n  };\n};\nfunction deriveState(state) {\n  const elements = Object.keys(state.elements);\n  const styles = lodashUnified.fromPairs(elements.map(element => [element, state.styles[element] || {}]));\n  const attributes = lodashUnified.fromPairs(elements.map(element => [element, state.attributes[element]]));\n  return {\n    styles,\n    attributes\n  };\n}\nexports.usePopper = usePopper;","map":{"version":3,"names":["usePopper","referenceElementRef","popperElementRef","opts","stateUpdater","name","enabled","phase","fn","state","derivedState","deriveState","Object","assign","states","value","requires","options","vue","computed","onFirstUpdate","placement","strategy","modifiers","unref","instanceRef","shallowRef","ref","styles","popper","position","left","top","arrow","attributes","destroy","watch","newOptions","instance","setOptions","deep","referenceElement","popperElement","core","createPopper","onBeforeUnmount","_a","update","forceUpdate","elements","keys","lodashUnified","fromPairs","map","element"],"sources":["../../../../../packages/hooks/use-popper/index.ts"],"sourcesContent":["import { computed, onBeforeUnmount, ref, shallowRef, unref, watch } from 'vue'\nimport { createPopper } from '@popperjs/core'\nimport { fromPairs } from 'lodash-unified'\n\nimport type { Ref } from 'vue'\nimport type {\n  Instance,\n  Modifier,\n  Options,\n  State,\n  VirtualElement,\n} from '@popperjs/core'\n\ntype ElementType = HTMLElement | undefined\ntype ReferenceElement = ElementType | VirtualElement\nexport type PartialOptions = Partial<Options>\n\nexport const usePopper = (\n  referenceElementRef: Ref<ReferenceElement>,\n  popperElementRef: Ref<ElementType>,\n  opts: Ref<PartialOptions> | PartialOptions = {} as PartialOptions\n) => {\n  const stateUpdater = {\n    name: 'updateState',\n    enabled: true,\n    phase: 'write',\n    fn: ({ state }) => {\n      const derivedState = deriveState(state)\n\n      Object.assign(states.value, derivedState)\n    },\n    requires: ['computeStyles'],\n  } as Modifier<'updateState', any>\n\n  const options = computed<Options>(() => {\n    const { onFirstUpdate, placement, strategy, modifiers } = unref(opts)\n\n    return {\n      onFirstUpdate,\n      placement: placement || 'bottom',\n      strategy: strategy || 'absolute',\n      modifiers: [\n        ...(modifiers || []),\n        stateUpdater,\n        { name: 'applyStyles', enabled: false },\n      ],\n    }\n  })\n\n  const instanceRef = shallowRef<Instance | undefined>()\n  const states = ref<Pick<State, 'styles' | 'attributes'>>({\n    styles: {\n      popper: {\n        position: unref(options).strategy,\n        left: '0',\n        top: '0',\n      },\n      arrow: {\n        position: 'absolute',\n      },\n    },\n    attributes: {},\n  })\n\n  const destroy = () => {\n    if (!instanceRef.value) return\n\n    instanceRef.value.destroy()\n    instanceRef.value = undefined\n  }\n\n  watch(\n    options,\n    (newOptions) => {\n      const instance = unref(instanceRef)\n      if (instance) {\n        instance.setOptions(newOptions)\n      }\n    },\n    {\n      deep: true,\n    }\n  )\n\n  watch(\n    [referenceElementRef, popperElementRef],\n    ([referenceElement, popperElement]) => {\n      destroy()\n      if (!referenceElement || !popperElement) return\n\n      instanceRef.value = createPopper(\n        referenceElement,\n        popperElement,\n        unref(options)\n      )\n    }\n  )\n\n  onBeforeUnmount(() => {\n    destroy()\n  })\n\n  return {\n    state: computed(() => ({ ...(unref(instanceRef)?.state || {}) })),\n    styles: computed(() => unref(states).styles),\n    attributes: computed(() => unref(states).attributes),\n    update: () => unref(instanceRef)?.update(),\n    forceUpdate: () => unref(instanceRef)?.forceUpdate(),\n    // Preventing end users from modifying the instance.\n    instanceRef: computed(() => unref(instanceRef)),\n  }\n}\n\nfunction deriveState(state: State) {\n  const elements = Object.keys(state.elements) as unknown as Array<\n    keyof State['elements']\n  >\n\n  const styles = fromPairs(\n    elements.map(\n      (element) =>\n        [element, state.styles[element] || {}] as [\n          string,\n          State['styles'][keyof State['styles']]\n        ]\n    )\n  )\n\n  const attributes = fromPairs(\n    elements.map(\n      (element) =>\n        [element, state.attributes[element]] as [\n          string,\n          State['attributes'][keyof State['attributes']]\n        ]\n    )\n  )\n\n  return {\n    styles,\n    attributes,\n  }\n}\n\nexport type UsePopperReturn = ReturnType<typeof usePopper>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}