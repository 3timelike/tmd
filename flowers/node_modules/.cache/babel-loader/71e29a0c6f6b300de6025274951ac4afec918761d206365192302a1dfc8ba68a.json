{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nrequire('../../../utils/index.js');\nrequire('../../../constants/index.js');\nrequire('../../../hooks/index.js');\nvar index = require('../../../hooks/use-namespace/index.js');\nvar index$1 = require('../../../hooks/use-id/index.js');\nvar aria = require('../../../constants/aria.js');\nvar style = require('../../../utils/dom/style.js');\nconst useDropdown = () => {\n  const elDropdown = vue.inject(\"elDropdown\", {});\n  const _elDropdownSize = vue.computed(() => elDropdown == null ? void 0 : elDropdown.dropdownSize);\n  return {\n    elDropdown,\n    _elDropdownSize\n  };\n};\nconst initDropdownDomEvent = (dropdownChildren, triggerElm, _instance) => {\n  const ns = index.useNamespace(\"dropdown\");\n  const menuItems = vue.ref(null);\n  const menuItemsArray = vue.ref(null);\n  const dropdownElm = vue.ref(null);\n  const listId = index$1.useId();\n  dropdownElm.value = dropdownChildren == null ? void 0 : dropdownChildren.subTree.el;\n  function removeTabindex() {\n    var _a;\n    triggerElm.setAttribute(\"tabindex\", \"-1\");\n    (_a = menuItemsArray.value) == null ? void 0 : _a.forEach(item => {\n      item.setAttribute(\"tabindex\", \"-1\");\n    });\n  }\n  function resetTabindex(ele) {\n    removeTabindex();\n    ele == null ? void 0 : ele.setAttribute(\"tabindex\", \"0\");\n  }\n  function handleTriggerKeyDown(ev) {\n    const code = ev.code;\n    if ([aria.EVENT_CODE.up, aria.EVENT_CODE.down].includes(code)) {\n      removeTabindex();\n      resetTabindex(menuItems.value[0]);\n      menuItems.value[0].focus();\n      ev.preventDefault();\n      ev.stopPropagation();\n    } else if (code === aria.EVENT_CODE.enter) {\n      _instance.handleClick();\n    } else if ([aria.EVENT_CODE.tab, aria.EVENT_CODE.esc].includes(code)) {\n      _instance.hide();\n    }\n  }\n  function handleItemKeyDown(ev) {\n    const code = ev.code;\n    const target = ev.target;\n    const currentIndex = menuItemsArray.value.indexOf(target);\n    const max = menuItemsArray.value.length - 1;\n    let nextIndex;\n    if ([aria.EVENT_CODE.up, aria.EVENT_CODE.down].includes(code)) {\n      if (code === aria.EVENT_CODE.up) {\n        nextIndex = currentIndex !== 0 ? currentIndex - 1 : 0;\n      } else {\n        nextIndex = currentIndex < max ? currentIndex + 1 : max;\n      }\n      removeTabindex();\n      resetTabindex(menuItems.value[nextIndex]);\n      menuItems.value[nextIndex].focus();\n      ev.preventDefault();\n      ev.stopPropagation();\n    } else if (code === aria.EVENT_CODE.enter) {\n      triggerElmFocus();\n      target.click();\n      if (_instance.props.hideOnClick) {\n        _instance.hide();\n      }\n    } else if ([aria.EVENT_CODE.tab, aria.EVENT_CODE.esc].includes(code)) {\n      _instance.hide();\n      triggerElmFocus();\n    }\n  }\n  function initAria() {\n    dropdownElm.value.setAttribute(\"id\", listId.value);\n    triggerElm.setAttribute(\"aria-haspopup\", \"list\");\n    triggerElm.setAttribute(\"aria-controls\", listId.value);\n    if (!_instance.props.splitButton) {\n      triggerElm.setAttribute(\"role\", \"button\");\n      triggerElm.setAttribute(\"tabindex\", _instance.props.tabindex);\n      style.addClass(triggerElm, ns.b(\"selfdefine\"));\n    }\n  }\n  function initEvent() {\n    var _a;\n    triggerElm == null ? void 0 : triggerElm.addEventListener(\"keydown\", handleTriggerKeyDown);\n    (_a = dropdownElm.value) == null ? void 0 : _a.addEventListener(\"keydown\", handleItemKeyDown, true);\n  }\n  function initDomOperation() {\n    menuItems.value = dropdownElm.value.querySelectorAll(\"[tabindex='-1']\");\n    menuItemsArray.value = Array.from(menuItems.value);\n    initEvent();\n    initAria();\n  }\n  function triggerElmFocus() {\n    triggerElm.focus();\n  }\n  initDomOperation();\n};\nexports.initDropdownDomEvent = initDropdownDomEvent;\nexports.useDropdown = useDropdown;","map":{"version":3,"names":["useDropdown","elDropdown","vue","inject","_elDropdownSize","computed","dropdownSize","initDropdownDomEvent","dropdownChildren","triggerElm","_instance","ns","index","useNamespace","menuItems","ref","menuItemsArray","dropdownElm","listId","index$1","useId","value","subTree","el","removeTabindex","_a","setAttribute","forEach","item","resetTabindex","ele","handleTriggerKeyDown","ev","code","aria","EVENT_CODE","up","down","includes","focus","preventDefault","stopPropagation","enter","handleClick","tab","esc","hide","handleItemKeyDown","target","currentIndex","indexOf","max","length","nextIndex","triggerElmFocus","click","props","hideOnClick","initAria","splitButton","tabindex","style","addClass","b","initEvent","addEventListener","initDomOperation","querySelectorAll","Array","from"],"sources":["../../../../../../packages/components/dropdown/src/useDropdown.ts"],"sourcesContent":["// @ts-nocheck\nimport { computed, inject, ref } from 'vue'\nimport { addClass } from '@element-plus/utils'\nimport { EVENT_CODE } from '@element-plus/constants'\nimport { useId, useNamespace } from '@element-plus/hooks'\nimport type { Nullable } from '@element-plus/utils'\nimport type { IElDropdownInstance } from './dropdown'\n\nexport const useDropdown = () => {\n  const elDropdown = inject<IElDropdownInstance>('elDropdown', {})\n  const _elDropdownSize = computed(() => elDropdown?.dropdownSize)\n\n  return {\n    elDropdown,\n    _elDropdownSize,\n  }\n}\n\nexport const initDropdownDomEvent = (\n  dropdownChildren,\n  triggerElm,\n  _instance\n) => {\n  const ns = useNamespace('dropdown')\n  const menuItems = ref<Nullable<HTMLButtonElement[]>>(null)\n  const menuItemsArray = ref<Nullable<HTMLElement[]>>(null)\n  const dropdownElm = ref<Nullable<HTMLElement>>(null)\n  const listId = useId()\n  dropdownElm.value = dropdownChildren?.subTree.el\n\n  function removeTabindex() {\n    triggerElm.setAttribute('tabindex', '-1')\n    menuItemsArray.value?.forEach((item) => {\n      item.setAttribute('tabindex', '-1')\n    })\n  }\n\n  function resetTabindex(ele) {\n    removeTabindex()\n    ele?.setAttribute('tabindex', '0')\n  }\n\n  function handleTriggerKeyDown(ev: KeyboardEvent) {\n    const code = ev.code\n    if ([EVENT_CODE.up, EVENT_CODE.down].includes(code)) {\n      removeTabindex()\n      resetTabindex(menuItems.value[0])\n      menuItems.value[0].focus()\n      ev.preventDefault()\n      ev.stopPropagation()\n    } else if (code === EVENT_CODE.enter) {\n      _instance.handleClick()\n    } else if ([EVENT_CODE.tab, EVENT_CODE.esc].includes(code)) {\n      _instance.hide()\n    }\n  }\n\n  function handleItemKeyDown(ev) {\n    const code = ev.code\n    const target = ev.target\n    const currentIndex = menuItemsArray.value.indexOf(target)\n    const max = menuItemsArray.value.length - 1\n    let nextIndex\n    if ([EVENT_CODE.up, EVENT_CODE.down].includes(code)) {\n      if (code === EVENT_CODE.up) {\n        nextIndex = currentIndex !== 0 ? currentIndex - 1 : 0\n      } else {\n        nextIndex = currentIndex < max ? currentIndex + 1 : max\n      }\n      removeTabindex()\n      resetTabindex(menuItems.value[nextIndex])\n      menuItems.value[nextIndex].focus()\n      ev.preventDefault()\n      ev.stopPropagation()\n    } else if (code === EVENT_CODE.enter) {\n      triggerElmFocus()\n      target.click()\n      if (_instance.props.hideOnClick) {\n        _instance.hide()\n      }\n    } else if ([EVENT_CODE.tab, EVENT_CODE.esc].includes(code)) {\n      _instance.hide()\n      triggerElmFocus()\n    }\n  }\n\n  function initAria() {\n    dropdownElm.value.setAttribute('id', listId.value)\n    triggerElm.setAttribute('aria-haspopup', 'list')\n    triggerElm.setAttribute('aria-controls', listId.value)\n    if (!_instance.props.splitButton) {\n      triggerElm.setAttribute('role', 'button')\n      triggerElm.setAttribute('tabindex', _instance.props.tabindex)\n      addClass(triggerElm, ns.b('selfdefine'))\n    }\n  }\n\n  function initEvent() {\n    triggerElm?.addEventListener('keydown', handleTriggerKeyDown)\n    dropdownElm.value?.addEventListener('keydown', handleItemKeyDown, true)\n  }\n\n  function initDomOperation() {\n    menuItems.value = dropdownElm.value.querySelectorAll(\n      \"[tabindex='-1']\"\n    ) as unknown as HTMLButtonElement[]\n    menuItemsArray.value = Array.from(menuItems.value)\n\n    initEvent()\n    initAria()\n  }\n\n  function triggerElmFocus() {\n    triggerElm.focus()\n  }\n\n  initDomOperation()\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}